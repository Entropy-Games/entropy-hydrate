<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Data Loading</title>
    <link rel="stylesheet" href="../index.css">
    <script defer type="module">
	    const start = performance.now();

	    import '../index.js';
		await hydrate.init();

		console.log(`Reservoir took ${performance.now() - start}ms to load`);

        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
		const N = 500;

		function makeText (length) {
			let result  = '';
			for (let i = 0; i < length; i++) {
				result += characters.charAt(Math.floor(Math.random() * characters.length));
			}
			return result;
		}

		const beforeComponent = performance.now();
		hydrate.Component('my-component', ({ text, show }) => `
            <p
                hidden="${!show}"
                style="border-bottom: 1px solid grey; overflow-x: hidden"
            >
                ${text}
            </p>
        `);
		console.log(`Component took ${performance.now() - beforeComponent}ms to define`);

		const data = Array(N).fill(0).map(() => ({
			text: makeText(50),
			show: true
		}));

		const before = performance.now();

		hydrate.set({
			testData: data
		}, true);

		const after = performance.now();
		console.log(`Time to create ${N} elements: ${(after - before).toFixed(3)}ms`);

		const nExecs = hydrate.performance.execs.length;
		const totalExecs = hydrate.performance.execs.reduce((a, b) => a + b, 0);
        console.log(`Time to execute JS: ${nExecs} * ${(totalExecs / nExecs).toFixed(3)} = ${totalExecs}ms`);
        console.log(`Total time: ${after - start}ms`);
    </script>
</head>
<body>
<main>
    <p foreach="a in testData">
        <my-component
            $text="a.text"
            $show="a.show"
        ></my-component>
    </p>
</main>
</body>
</html>